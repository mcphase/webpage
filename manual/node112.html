<!DOCTYPE HTML>

<!--Converted with LaTeX2HTML 2025 (Released January 1, 2025) -->
<HTML lang="en">
<HEAD>
<TITLE>External module function mqcalc - used by mcdiff </TITLE>

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="viewport" CONTENT="width=device-width, initial-scale=1.0">
<META NAME="Generator" CONTENT="LaTeX2HTML v2025">

<LINK REL="STYLESHEET" HREF="manual.css">

<LINK REL="next" HREF="node113.html">
<LINK REL="previous" HREF="node111.html">
<LINK REL="next" HREF="node113.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A
 HREF="node113.html">
<IMG WIDTH="37" HEIGHT="24" ALT="next" SRC="next.png"></A> 
<A
 HREF="node102.html">
<IMG WIDTH="26" HEIGHT="24" ALT="up" SRC="up.png"></A> 
<A
 HREF="node111.html">
<IMG WIDTH="63" HEIGHT="24" ALT="previous" SRC="prev.png"></A> 
<A ID="tex2html986"
  HREF="node8.html">
<IMG WIDTH="65" HEIGHT="24" ALT="contents" SRC="contents.png"></A> 
<A ID="tex2html988"
  HREF="node180.html">
<IMG WIDTH="43" HEIGHT="24" ALT="index" SRC="index.png"></A> 
<BR>
<B> Next:</B> <A
 HREF="node113.html">External module functions dmq1</A>
<B> Up:</B> <A
 HREF="node102.html">Module Functions for Observables</A>
<B> Previous:</B> <A
 HREF="node111.html">External module function dS1</A>
 &nbsp; <B>  <A ID="tex2html987"
  HREF="node8.html">Contents</A></B> 
 &nbsp; <B>  <A ID="tex2html989"
  HREF="node180.html">Index</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->

<H3><A ID="SECTION0001621000000000000000"></A><A ID="4177"></A>
<BR>
External module function <I CLASS="slanted">mqcalc</I> - used by <I CLASS="slanted">mcdiff</I>  
</H3><SPAN CLASS="SMALL">
</SPAN>
<P>
<SPAN CLASS="SMALL">&rdquo;going beyond&rdquo;  dipolar approximation is a desirable feature of an accurate
 calculation of magnetic neutron scattering intensity and can be performed using
 mcphase. The internal module <I CLASS="slanted">so1ion</I><A ID="4179"></A> does this in an excellent
 way for the ground state multiplet of rare earth atoms (see section <A HREF="node55.html#mcdiff_gobeyond">8.5</A>)
 using equations (<A HREF="node55.html#scattoperator">70</A>) for the scattering operator <!-- MATH
 $\hat \mathcal Q$
 -->
<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.65ex; vertical-align: -0.34ex; " SRC="img976.svg"
 ALT="$\hat \mathcal Q$"></SPAN>.
 A more general formula for this scattering operator operator relates this operator
 to the Fourier transform of the magnetisation density <!-- MATH
 $\mathbf M(\mathbf r)$
 -->
<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.55ex; vertical-align: -0.70ex; " SRC="img977.svg"
 ALT="$\mathbf M(\mathbf r)$"></SPAN>of the unfilled shell of a specific
 ion&nbsp;[<A
 HREF="node179.html#lovesey84-1">32</A>]:
</SPAN>
<P>
<SPAN CLASS="SMALL"></SPAN>
<DIV CLASS="displaymath">

<!-- MATH
 \begin{equation}
\mathbf Q \times (\hat \mathcal Q \times  \mathbf Q) = \frac{-1}{2\mu_B}
   \mathbf Q \times (\hat \mathbf M(\mathbf Q) \times \mathbf Q) =\frac{-1}{2\mu_B} \int d\mathbf r
e^{i\mathbf Q \mathbf r} \left [ 
     \mathbf Q \times (\hat \mathbf M(\mathbf r) \times \mathbf Q) \right ]
 
\end{equation}
 -->
 &nbsp;  <A ID="scattop"></A><IMG
 STYLE="height: 4.40ex; vertical-align: -1.63ex; " SRC="img978.svg"
 ALT="$\displaystyle
\mathbf Q \times (\hat \mathcal Q \times \mathbf Q) = \frac{-1...
... [
\mathbf Q \times (\hat \mathbf M(\mathbf r) \times \mathbf Q) \right ]
$"> <SPAN class="FLOATRIGHT">
(<SPAN CLASS="arabic">136</SPAN>)</SPAN>
</DIV><SPAN CLASS="SMALL">
</SPAN>
<P>
<SPAN CLASS="SMALL">Note that the magnetisation density consists of two contributions 
<!-- MATH
 $\hat \mathbf M(\mathbf r)=\hat \mathbf M_S(\mathbf r)+\hat \mathbf M_L(\mathbf r)$
 -->
<SPAN CLASS="MATH"><IMG
 STYLE="height: 3.01ex; vertical-align: -0.70ex; " SRC="img979.svg"
 ALT="$\hat \mathbf M(\mathbf r)=\hat \mathbf M_S(\mathbf r)+\hat \mathbf M_L(\mathbf r)$"></SPAN>, the
 spin and orbital contribution. The orbital contribution is not uniquely defined due to a gauge
 freedom (<!-- MATH
 $\nabla \times \hat \mathbf M_L (\mathbf r)=\hat \mathbf j(\mathbf r)$
 -->
<SPAN CLASS="MATH"><IMG
 STYLE="height: 3.03ex; vertical-align: -0.70ex; " SRC="img980.svg"
 ALT="$\nabla \times \hat \mathbf M_L (\mathbf r)=\hat \mathbf j(\mathbf r)$"></SPAN>, the curl of the 
magnetisation must give the current density, so any gradient of a potential may be added
to <!-- MATH
 $\hat \mathbf M(\mathbf r)$
 -->
<SPAN CLASS="MATH"><IMG
 STYLE="height: 3.01ex; vertical-align: -0.70ex; " SRC="img981.svg"
 ALT="$\hat \mathbf M(\mathbf r)$"></SPAN> without changing the result). However, this does not matter, because adding a gradient of a potential
to <!-- MATH
 $\hat \mathbf M(\mathbf r)$
 -->
<SPAN CLASS="MATH"><IMG
 STYLE="height: 3.01ex; vertical-align: -0.70ex; " SRC="img981.svg"
 ALT="$\hat \mathbf M(\mathbf r)$"></SPAN> will just give a contribution <!-- MATH
 $\mathbf Q \times \mathbf Q \times \mathbf Q=0$
 -->
<SPAN CLASS="MATH"><IMG
 STYLE="height: 2.27ex; vertical-align: -0.57ex; " SRC="img982.svg"
 ALT="$\mathbf Q \times \mathbf Q \times \mathbf Q=0$"></SPAN> to the equation (<A HREF="#scattop">144</A>),
thus the neutron scattering cross section is not sensitive to the chosen gauge, which is an important feature of the theory.
</SPAN>
<P>
<SPAN CLASS="SMALL">Technically,  &rdquo;going beyond&rdquo;  dipolar approximation in the program <I CLASS="slanted">mcdiff<A ID="4192"></A></I>
can be done with  module functions <I CLASS="slanted">mq</I> and <I CLASS="slanted">estates</I>. 
The output of <I CLASS="slanted">mq</I> is the Fourier transform of the magnetization
density in units of <SPAN CLASS="MATH"><IMG
 STYLE="height: 1.68ex; vertical-align: -0.57ex; " SRC="img916.svg"
 ALT="$\mu_B$"></SPAN>, which is equivalent to two times the scattering operator 
 <!-- MATH
 $\langle \hat \mathcal Q^{d \dag }_{\alpha} \rangle_{T,H}$
 -->
<SPAN CLASS="MATH"><IMG
 STYLE="height: 3.09ex; vertical-align: -0.78ex; " SRC="img983.svg"
 ALT="$\langle \hat \mathcal Q^{d \dag }_{\alpha} \rangle_{T,H}$"></SPAN> for
 a given orientation of the scattering vector. <I CLASS="slanted">mq</I> is called many times, for
 every scattering vector. In order to
 do an efficient calculation the eigenstates should be calculated only
 once, this is the task of function <I CLASS="slanted">estates</I>.
</SPAN>
<P>
<SPAN CLASS="SMALL">The format to be used is:
<SPAN CLASS="FOOTNOTESIZE">
</SPAN></SPAN><PRE>
extern "C" void mqcalc(ComplexVector &amp; mq,double &amp; th,double &amp; ph,double J0,
double &amp; J2, double &amp; J4, double &amp; J6,ComplexMatrix &amp; est)
</PRE><SPAN CLASS="SMALL"><SPAN CLASS="FOOTNOTESIZE">
</SPAN></SPAN>
<P>
<SPAN CLASS="SMALL"><SPAN CLASS="FOOTNOTESIZE">The meaning of the symbols is as follows:
</SPAN></SPAN>
<P>
<SPAN CLASS="SMALL"><SPAN CLASS="FOOTNOTESIZE"></SPAN></SPAN><PRE>
on input
   th     polar angle theta of the scattering vector Q (angle with the axb axis=c axis) in rad
   ph     polar angle phi of the scattering vector Q (angle with bx(axb)=a in the 
          projection into the  bx(axb),b plane = angle with a in the projection into the 
		  ab plane) in rad
   J0,J2,J4,J6     form factor functions &lt;jn(Q)&gt;   
   est             eigenstate matrix (as calculated by estates),
                   it should also contain population numbers of the states
on output
   mq(1..3)        Kartesian components of the scattering operator mq=&lt;M(Q)&gt;/muB=-2&lt;Q&gt;_TH
                    Note that: 
                               mq(1)=&lt;Mbx(axb)(Q)&gt;/muB
                               mq(2)=&lt;Mb(Q)&gt;/muB
                               mq(3)=&lt;Maxb(Q)&gt;/muB
                    according to Lovesey Neutron Scattering equation 6.87b the 
                    scattering operator is given in  spherical coordinates 
					Q-1,Q0,Q+1 (introduced as described above on input of th and ph)
					these are related to cartesion coordinates by 11.123
				    thus at Q=0  &lt;M(Q)&gt;=2&lt;S&gt;+&lt;L&gt;
</PRE><SPAN CLASS="SMALL"><SPAN CLASS="FOOTNOTESIZE"></SPAN>
</SPAN>
<P>
<SPAN CLASS="SMALL"></SPAN>
<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A
 HREF="node113.html">
<IMG WIDTH="37" HEIGHT="24" ALT="next" SRC="next.png"></A> 
<A
 HREF="node102.html">
<IMG WIDTH="26" HEIGHT="24" ALT="up" SRC="up.png"></A> 
<A
 HREF="node111.html">
<IMG WIDTH="63" HEIGHT="24" ALT="previous" SRC="prev.png"></A> 
<A ID="tex2html986"
  HREF="node8.html">
<IMG WIDTH="65" HEIGHT="24" ALT="contents" SRC="contents.png"></A> 
<A ID="tex2html988"
  HREF="node180.html">
<IMG WIDTH="43" HEIGHT="24" ALT="index" SRC="index.png"></A> 
<BR>
<B> Next:</B> <A
 HREF="node113.html">External module functions dmq1</A>
<B> Up:</B> <A
 HREF="node102.html">Module Functions for Observables</A>
<B> Previous:</B> <A
 HREF="node111.html">External module function dS1</A>
 &nbsp; <B>  <A ID="tex2html987"
  HREF="node8.html">Contents</A></B> 
 &nbsp; <B>  <A ID="tex2html989"
  HREF="node180.html">Index</A></B> </DIV>
<!--End of Navigation Panel-->

</BODY>
</HTML>
